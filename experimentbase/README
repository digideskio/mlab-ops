
The scripts in these sub-directories provide assistance with managing M-Lab
experiments.

OVERVIEW
========

There are three directories of interest:
    
    initscript --

        This directory contains a default initscript for slices running on
        M-Lab.  The initscript is part of the PlanetLab initscript mechanism.
        It will be installed as /etc/init.d/vinit.slice

        This script is installed in the slice at first creation.  It's purpose
        is to setup the local environment to support crond, rsyslog, and
        download, verify and install a minimal set of scripts for managing the
        installation of the actual slice image.

        On first invocation, it asserts some basic slice environment settings,
        i.e. crond is running, rsyslogd and then attempts to download the
        slice-manager package.

    smp --

        This directory is the slice manager package.  The slice manager installs
        some generic support services needed by all slices.  Specifically, it
        configures rsyncd, creates necessary directories, and installs generic
        script functions for use by experiment scripts.  
        
        The slice manager installs '/etc/init.d/slicectrl'.  slicectrl update
        checks for an experiment-specific package, downloads and installs it.

        TODO: add a random delay within the hour to avoid hitting central all at once.

    slice_example --

        This directory provides an minimal template for an experiment that will
        work with the slice manager.


SLICE EXAMPLE DETAILS
=====================

The SliceManagementPackage only needs a few entry points into your experiment.

The scripts in slice_example/init/ will all run AS THE SLICE USER, not as root.
Therefore, every action that requires elevated privileges must be taken using
'sudo' or another mechanism.

The CWD will be the root of the package directory.
    i.e. /home/mlab_slice/current/*

The current version of your experiment will always be under $HOME/current/*,
where '*' is the root of your experiment tar archive.  Every previously
deployed version of your experiment package will be saved.

Example scripts:

    install - optional.  

              If your experiment requires additional one-time configuration such
              as installation of dependent packages, setup of config files in
              httpd or other, this is the place to do it.  This script should be
              idempotent; it should be possible to run it repeatedly without ill
              effect.  'install' will be run every time a new version of your
              slice package is installed.  But, if package dependencies have
              already been installed, then it is not necessary to repeat them,
              or new dependencies may have been added in the new version.

    start - required. 

            This script should start any processes needed by your service.
              
    stop -  required.
            
            This script should gracefully stop any processes that were started
            by your service.  After this script returns, a more, let's say,
            assertive script will forcibly stop any processes remaining that are
            not part of the slice management packages.

    status - optional, encouraged

            This script should return a status for the running service suitable
            for input to Nagios.  By default, service status is just the number
            of processes running.  You are encouraged to provide a more
            meaningful indication of service health and liveness.  This will
            assist you when observing the status of your service across M-Lab
            and it will assist M-Lab operators who may see issues first.


